{% extends 'base.html' %}
{% block title %}{{ title }}{% endblock %} 
{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <h4 class="mb-0"><i class="fas fa-user-edit"></i> {{ title }}</h4>
      </div>
      <div class="card-body">
        <form method="post">
          {% csrf_token %} {% if employee_type %}
          <input
            type="hidden"
            name="employee_type"
            value="{{ employee_type }}"
          />
          {% endif %} {% if form.non_field_errors %}
          <div class="alert alert-danger">{{ form.non_field_errors }}</div>
          {% endif %}

          <!-- Type d'employé (pour création) -->
          {% if not employee %}
          <div class="row mb-4">
            <div class="col-12">
              <h5>Type d'employé</h5>
              <div class="btn-group w-100" role="group">
                <input type="radio" class="btn-check" name="employee_type"
                id="type_external" value="external" 
                {% if employee_type == 'external' %}checked{% endif %}>
                <label class="btn btn-outline-warning" for="type_external">
                  <i class="fas fa-user-clock"></i> Employé externe
                  <small class="d-block"
                    >Planning uniquement, sans compte de connexion</small
                  >
                </label>

                <input type="radio" class="btn-check" name="employee_type"
                id="type_internal" value="internal" 
                {% if employee_type == 'internal' %}checked{% endif %}>
                <label class="btn btn-outline-success" for="type_internal">
                  <i class="fas fa-user-check"></i> Employé interne
                  <small class="d-block"
                    >Avec compte pour se connecter au système</small
                  >
                </label>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Informations personnelles -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label
                for="{{ form.first_name.id_for_label }}"
                class="form-label"
              >
                Prénom <span class="text-danger">*</span>
              </label>
              {{ form.first_name }} {% if form.first_name.errors %}
              <div class="text-danger small">{{ form.first_name.errors }}</div>
              {% endif %}
            </div>
            <div class="col-md-6">
              <label for="{{ form.last_name.id_for_label }}" class="form-label">
                Nom <span class="text-danger">*</span>
              </label>
              {{ form.last_name }} {% if form.last_name.errors %}
              <div class="text-danger small">{{ form.last_name.errors }}</div>
              {% endif %}
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label for="{{ form.phone.id_for_label }}" class="form-label"
                >Téléphone</label
              >
              {{ form.phone }} {% if form.phone.errors %}
              <div class="text-danger small">{{ form.phone.errors }}</div>
              {% endif %}
            </div>
            <div class="col-md-6">
              <label for="{{ form.hire_date.id_for_label }}" class="form-label"
                >Date d'embauche</label
              >
              {{ form.hire_date }} {% if form.hire_date.errors %}
              <div class="text-danger small">{{ form.hire_date.errors }}</div>
              {% endif %}
            </div>
          </div>

          <!-- Champs spécifiques aux employés internes -->
          {% if employee_type == 'internal' or form.username %}
          <hr />
          <h5>Compte utilisateur</h5>

          <div class="row mb-3">
            <div class="col-md-6">
              <label for="{{ form.username.id_for_label }}" class="form-label">
                Nom d'utilisateur <span class="text-danger">*</span>
              </label>
              {{ form.username }} {% if form.username.errors %}
              <div class="text-danger small">{{ form.username.errors }}</div>
              {% endif %} {% if form.username.help_text %}
              <small class="form-text text-muted"
                >{{ form.username.help_text }}</small
              >
              {% endif %}
            </div>
            <div class="col-md-6">
              <label for="{{ form.email.id_for_label }}" class="form-label"
                >Email</label
              >
              {{ form.email }} {% if form.email.errors %}
              <div class="text-danger small">{{ form.email.errors }}</div>
              {% endif %}
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label for="{{ form.password.id_for_label }}" class="form-label">
                Mot de passe <span class="text-danger">*</span>
              </label>
              {{ form.password }} {% if form.password.errors %}
              <div class="text-danger small">{{ form.password.errors }}</div>
              {% endif %} {% if form.password.help_text %}
              <small class="form-text text-muted"
                >{{ form.password.help_text }}</small
              >
              {% endif %}
            </div>
            <div class="col-md-6">
              <label
                for="{{ form.password_confirm.id_for_label }}"
                class="form-label"
              >
                Confirmer le mot de passe <span class="text-danger">*</span>
              </label>
              {{ form.password_confirm }} {% if form.password_confirm.errors %}
              <div class="text-danger small">
                {{ form.password_confirm.errors }}
              </div>
              {% endif %}
            </div>
          </div>

          <div class="mb-3">
            <label for="{{ form.user_group.id_for_label }}" class="form-label">
              Groupe d'accès <span class="text-danger">*</span>
            </label>
            {{ form.user_group }} {% if form.user_group.errors %}
            <div class="text-danger small">{{ form.user_group.errors }}</div>
            {% endif %} {% if form.user_group.help_text %}
            <small class="form-text text-muted"
              >{{ form.user_group.help_text }}</small
            >
            {% endif %}
          </div>
          {% endif %}

          <!-- Statuts (pour modification) -->
          {% if employee %}
          <hr />
          <h5>Statut</h5>

          <div class="row mb-3">
            {% if form.is_external %}
            <div class="col-md-6">
              <div class="form-check">
                {{ form.is_external }}
                <label
                  class="form-check-label"
                  for="{{ form.is_external.id_for_label }}"
                >
                  Employé externe
                </label>
              </div>
              {% if form.is_external.help_text %}
              <small class="form-text text-muted"
                >{{ form.is_external.help_text }}</small
              >
              {% endif %}
            </div>
            {% endif %} {% if form.is_active %}
            <div class="col-md-6">
              <div class="form-check">
                {{ form.is_active }}
                <label
                  class="form-check-label"
                  for="{{ form.is_active.id_for_label }}"
                >
                  Employé actif
                </label>
              </div>
              {% if form.is_active.help_text %}
              <small class="form-text text-muted"
                >{{ form.is_active.help_text }}</small
              >
              {% endif %}
            </div>
            {% endif %}
          </div>
          {% endif %}

          <!-- Boutons -->
          <div class="d-flex justify-content-between">
            <a
              href="{% url 'staff:employees_list' %}"
              class="btn btn-secondary"
            >
              <i class="fas fa-arrow-left"></i> Retour
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              {% if employee %}Modifier{% else %}Créer{% endif %} l'employé
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // Changer dynamiquement le formulaire selon le type d'employé
  document.addEventListener("DOMContentLoaded", function () {
    const typeRadios = document.querySelectorAll('input[name="employee_type"]');

    typeRadios.forEach((radio) => {
      radio.addEventListener("change", function () {
        const currentUrl = new URL(window.location);
        currentUrl.searchParams.set("type", this.value);
        window.location.href = currentUrl.toString();
      });
    });
  });
</script>
{% endblock %}
